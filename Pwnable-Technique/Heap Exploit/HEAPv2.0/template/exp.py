#!/usr/bin/env python3
from pwn import *

elf = ELF("./vuln")
libc = ELF("./libc.so.6")
context.update(binary=elf, log_level="debug")
p = elf.process()
gdb.attach(
    p,
    """
    b *main+103
    b *main+115
    b *main+127
    b *main+139
    """,
)

def create(index, size, data):
    p.sendlineafter(b'> ', b'1')
    p.sendlineafter(b'Index: ', str(index).encode())
    p.sendlineafter(b'Size: ', str(int(size)).encode())
    p.sendlineafter(b'Data: ', data)

def show(index):
    p.sendlineafter(b'>', b'2')
    p.sendlineafter(b'Index: ', str(index).encode())
    p.recvuntil(b'Data: ')
    return u64(p.recvline().rstrip().ljust(8, b'\x00'))

def edit(index, data):
    p.sendlineafter(b'>', b'3')
    p.sendlineafter(b'Index: ', str(index).encode()); time.sleep(0.2)
    p.sendline(data)

def delete(index):
    p.sendlineafter(b'>', b'4')
    p.sendlineafter(b'Index: ', str(index).encode())


create(0, 0x18, b"A"*0x18)
create(1, 0x110, b"B"*0x10)
create(2, 0x60, b"C"*0x10)
create(3, 0x60, b"D"*0x10)



p.interactive()