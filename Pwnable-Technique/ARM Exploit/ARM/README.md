# Assembly Language Programming with ARM

Dưới đây là một số hướng dẫn cơ bản của hợp ngữ ARM:

1. **MOV**: Đây là lệnh để di chuyển giá trị từ một địa chỉ đến một thanh ghi hoặc giữa các thanh ghi. Ví dụ:

   ```
   MOV r0, #10     ; Đặt giá trị 10 vào thanh ghi r0
   MOV r1, r2      ; Gán giá trị của r2 vào r1
   ```

2. **ADD, SUB**: Đây là các lệnh để thực hiện phép cộng và trừ. Ví dụ:

   ```
   ADD r3, r3, #5  ; r3 = r3 + 5
   SUB r4, r4, r5  ; r4 = r4 - r5
   ```

3. **CMP**: Lệnh này so sánh hai giá trị và cập nhật các cờ tương ứng. Ví dụ:

   ```
   CMP r0, r1      ; So sánh giá trị trong r0 và r1
   ```

4. **B**: Lệnh này là lệnh nhảy không điều kiện. Nó sẽ nhảy đến một địa chỉ khác trong chương trình. Ví dụ:

   ```
   B label_name    ; Nhảy đến địa chỉ được định nghĩa bởi label_name
   ```

5. **BEQ, BNE, BGT, BLT, ...**: Các lệnh nhảy có điều kiện, sẽ nhảy đến một địa chỉ khác dựa trên trạng thái của các cờ (VD: Bằng nhau, Không bằng nhau, Lớn hơn, Nhỏ hơn, ...).

6. **LDR, STR**: Lệnh này để đọc và ghi dữ liệu từ và vào bộ nhớ. Ví dụ:

   ```
   LDR r0, [r1]    ; Load giá trị từ địa chỉ chứa bởi r1 vào r0
   STR r2, [r3]    ; Ghi giá trị trong r2 vào địa chỉ chứa bởi r3
   ```

7. **LDM, STM**: Lệnh này để load và store nhiều thanh ghi cùng lúc. Ví dụ:

   ```
   LDMIA r4!, {r5, r6, r7}   ; Load giá trị từ r4, sau đó tăng r4 và gán vào r5, r6, r7.
   ```

8. **PUSH, POP**: Lệnh này được sử dụng để thêm và xóa dữ liệu từ ngăn xếp. Ví dụ:

   ```
   PUSH {r0, r1, r2}   ; Đẩy r0, r1, r2 vào ngăn xếp
   POP {r0, r1, r2}    ; Lấy dữ liệu từ ngăn xếp vào r0, r1, r2
   ```

9. **BL, BX**: Lệnh BL dùng để gọi một hàm con (subroutine). Lệnh BX dùng để nhảy về nơi đã gọi hàm con đó.

   ```
   BL function_name    ; Gọi hàm con tên function_name
   BX lr              ; Nhảy về nơi đã gọi hàm con
   ```

10. **NOP**: Lệnh này không thực hiện bất kỳ thao tác nào. Nó thường được sử dụng để tạo độ trễ hoặc đánh dấu vị trí trong mã.

   ```
   NOP   ; No operation
   ```


11. **ADRP**: Lệnh `ADRP` trong hợp ngữ ARM64 (AArch64) dùng để tính địa chỉ cơ bản (base address) của một biến hoặc mảng trong bộ nhớ. Lệnh này thường đi kèm với lệnh `LDR` để lấy giá trị tại địa chỉ đã tính toán.

Cú pháp của lệnh `ADRP` như sau:

```
ADRP Xd, label
```

Trong đó:
- `Xd` là thanh ghi đích (destination register) để lưu giá trị địa chỉ tính toán.
- `label` là nhãn (label) của biến hoặc mảng cần tính địa chỉ cơ bản.

Lệnh `ADRP` tính toán địa chỉ cơ bản bằng cách lấy địa chỉ của nhãn `label`, sau đó xóa đi 12 bit cuối của địa chỉ này (vì các địa chỉ thường được căn chỉnh ở dạng byte, và 12 bit cuối đại diện cho các offset trong một trang 4KB). Kết quả là địa chỉ cơ bản của biến hoặc mảng đó sẽ được lưu vào thanh ghi `Xd`.

Sau khi đã tính được địa chỉ cơ bản, bạn có thể sử dụng lệnh `LDR` hoặc các lệnh khác để truy xuất dữ liệu tại địa chỉ đó.

Ví dụ:

```assembly
ADRP X0, my_array    ; Tính địa chỉ cơ bản của mảng my_array và lưu vào X0
LDR  X1, [X0, #8]    ; Load giá trị tại địa chỉ X0 + 8 vào X1
```

Trong ví dụ trên, lệnh `ADRP` tính địa chỉ cơ bản của `my_array` và lưu vào thanh ghi `X0`, sau đó lệnh `LDR` sẽ load giá trị tại địa chỉ `X0 + 8` vào thanh ghi `X1`.


12. **B.EQ and B.GT**: Trong hợp ngữ ARM, các lệnh như `B.EQ` và `B.GT` đều là các lệnh nhảy có điều kiện (conditional branch instructions) và dùng để điều khiển luồng thực thi của chương trình dựa trên các điều kiện cụ thể.

13. `B.EQ`: Đây là lệnh nhảy có điều kiện "Branch if Equal". Nếu điều kiện bằng (equal) được đáp ứng, chương trình sẽ nhảy đến địa chỉ được chỉ định. Điều kiện này thường được kiểm tra bằng cách so sánh các thanh ghi.

14. `B.GT`: Đây là lệnh nhảy có điều kiện "Branch if Greater Than". Nếu điều kiện "lớn hơn" được đáp ứng, chương trình sẽ nhảy đến địa chỉ được chỉ định. Điều kiện này thường được kiểm tra bằng cách so sánh các thanh ghi.

Cú pháp chung của các lệnh nhảy có điều kiện trong ARM:

```assembly
B{condition} label
```

Trong đó:
- `{condition}` là điều kiện dựa trên kết quả của các lệnh trước đó (ví dụ: `EQ` cho "bằng", `GT` cho "lớn hơn").
- `label` là nhãn (label) của địa chỉ mục tiêu.

Ví dụ sử dụng:

```assembly
CMP R0, R1    ; So sánh R0 và R1
BEQ label     ; Nếu R0 bằng R1, thì nhảy đến label
BGT label     ; Nếu R0 lớn hơn R1, thì nhảy đến label
```

Trong ví dụ trên, nếu kết quả của so sánh `CMP` thỏa mãn điều kiện, chương trình sẽ nhảy đến địa chỉ được chỉ định bởi `label`.

